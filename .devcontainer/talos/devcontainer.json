{
  "name": "talos",
  "image": "ghcr.io/nifr/talos:latest",
  "overrideCommand": false,
  "runArgs": [
    "--hostname=talos",
    "--name=devcontainer-nifr-talos-${devcontainerId}",
    "--privileged"
  ],
  "containerEnv": {
    "SSH_AUTH_SOCK": "/run/host-services/ssh-auth.sock"
  },
  "remoteEnv": {
    "SSH_AUTH_SOCK": "/run/host-services/ssh-auth.sock"
  },
  "portsAttributes": {
    "*": {
      "onAutoForward": "ignore"
    }
  },
  "features": {
    "ghcr.io/devcontainers/features/git:1": {},
    "./features/talosctl": {
      "version": "1.11.0"
    },
    "./features/symfony-cli": {
      "version": "5.12.0"
    }
  },
  "mounts": [
    {
      "type": "bind",
      "source": "/run/host-services/ssh-auth.sock",
      "target": "/run/host-services/ssh-auth.sock"
    },
    {
      "type": "bind",
      "source": "/var/run/docker.sock",
      "target": "/var/run/docker-host.sock"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/GH_TOKEN",
      "target": "/run/secrets/GH_TOKEN"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/HCLOUD_TOKEN",
      "target": "/run/secrets/HCLOUD_TOKEN"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/PULUMI_ACCESS_TOKEN",
      "target": "/run/secrets/PULUMI_ACCESS_TOKEN"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/ssh_public_key",
      "target": "/run/secrets/ssh_public_key"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/ATUIN_USERNAME",
      "target": "/run/secrets/ATUIN_USERNAME"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/ATUIN_PASSWORD",
      "target": "/run/secrets/ATUIN_PASSWORD"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/ATUIN_KEY",
      "target": "/run/secrets/ATUIN_KEY"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/CLOUDFLARE_EMAIL",
      "target": "/run/secrets/CLOUDFLARE_EMAIL"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/CLOUDFLARE_ACCOUNT_ID",
      "target": "/run/secrets/CLOUDFLARE_ACCOUNT_ID"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/CLOUDFLARE_DNS_API_TOKEN",
      "target": "/run/secrets/CLOUDFLARE_DNS_API_TOKEN"
    },
    {
      "type": "bind",
      "source": "${localWorkspaceFolder}/.devcontainer/.secrets/CLOUDFLARE_API_TOKEN",
      "target": "/run/secrets/CLOUDFLARE_API_TOKEN"
    }
  ],
  "secrets": {
    "GH_TOKEN": {
      "description": "(required) Personal Access Token (PAT), used by GitHub CLI \"gh\"",
      "documentationUrl": "https://github.com/settings/tokens"
    },
    "HCLOUD_TOKEN": {
      "description": "(required) Hetzner Cloud API token, used by \"hcloud\" and Pulumi",
      "documentationUrl": "https://console.hetzner.com/projects/<project_id>/security/tokens"
    },
    "PULUMI_ACCESS_TOKEN": {
      "description": "(required) Pulumi Cloud Access Token, used by Pulumi",
      "documentationUrl": "https://app.pulumi.com/user/settings/tokens"
    },
    "CLOUDFLARE_EMAIL": {
      "description": "(required) Cloudflare API Token, used by Pulumi",
      "documentationUrl": "https://developers.cloudflare.com/api/tokens/"
    },
    "CLOUDFLARE_API_TOKEN": {
      "description": "(required) Cloudflare API Token, used by Pulumi",
      "documentationUrl": "https://developers.cloudflare.com/api/tokens/"
    },
    "CLOUDFLARE_DNS_API_TOKEN": {
      "description": "(required) Cloudflare DNS API Token, used by Lego for DNS-01 challenges",
      "documentationUrl": "https://developers.cloudflare.com/api/tokens/"
    }
  },
  "hostRequirements": {
    "cpus": 4,
    "memory": "15gb",
    "storage": "32gb",
    "gpu": "optional"
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "pulumi.pulumi-vscode-tools"
      ]
    },
    "codespaces": {
      "repositories": {
        "nifr/*": {
          "permissions": {
            "contents": "write",
            "workflows": "write",
            "packages": "read",
            "actions": "write"
          }
        }
      }
    }
  }
}
